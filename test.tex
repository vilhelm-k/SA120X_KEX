\documentclass[a4paper]{article}
\usepackage[margin=2cm]{geometry}

\usepackage{graphicx} % Required for inserting images
\usepackage[british]{babel}
\usepackage{amsmath, amssymb}
\title{KEX}
\author{Alexander Santi Straihamer}
\date{January 2025}
\usepackage[dvipsnames]{xcolor}

\begin{document}

\maketitle

% Alexander
%TSPTW


\subsection{Base Problem (Augmented-Node Formulation)}

\subsubsection*{Sets and Parameters}

\begin{itemize}
\item $V$: Set of all patients (indexed by $i$)
\item $K$: Set of caregivers (indexed by $k$)
\item $\sigma_k$: Start node of caregiver $k$
\item $\tau_k$: End node of caregiver $k$
\item $V_k := V \cup \{\sigma_k, \tau_k\}$: Augmented set of nodes for caregiver $k$
\item $c_{ij} \in \mathbb{R}_{\geq 0}$: Travel time from node $i$ to node $j$
\item $[e_i, l_i] \subset \mathbb{R}$: Time window for patient $i$ (earliest $e_i$ and latest $l_i$ service start times)
\item $s_i \in \mathbb{R}_{\geq 0}$: Service time at patient $i$
\item $p_i^k \in \{0,1\}$: Binary parameter indicating if caregiver $k$ is qualified to treat patient $i$
\item $M \in \mathbb{R}_{\geq 0}$: A sufficiently large constant
\end{itemize}

\subsubsection*{Decision Variables}

\begin{itemize}
\item $x_{ij}^{k} \in \{0,1\}$: Binary variable indicating if caregiver $k$ travels directly from node $i$ to node $j$. Defined for each $k \in K$ and $i, j \in V_k$ with $i \neq j$.
\item $t_i^k \in \mathbb{R}_{\geq 0}$: Arrival time of caregiver $k$ at node $i \in V_k$
\item $d^k \in \mathbb{R}_{\geq 0}$: Down-time for caregiver $k$
\end{itemize}

\subsubsection*{Optimization Problem}

\begin{align}
\text{minimize} \quad & \sum_{k \in K} d^k
&& \tag{V1} \label{eq:MinimizeDowntime} \\
\text{subject to}\quad
& \sum_{k \in K} \sum_{\substack{j \in V_k \\ j \neq i}} x_{ij}^k = 1, &\quad \forall i \in V \tag{V2} \label{eq:UniqueVisit} \\
& \sum_{\substack{j \in V_k \\ j \neq i}} x_{ij}^k - \sum_{\substack{j \in V_k \\ j \neq i}} x_{ji}^k = 0, &\quad \forall i \in V, \forall k \in K \tag{V3} \label{eq:FlowConservation} \\
& \sum_{\substack{j \in V_k \\ j \neq \sigma_k}} x_{\sigma_k j}^k = \sum_{\substack{j \in V_k \\ j \neq \tau_k}} x_{j \tau_k}^k \leq 1, &\quad \forall k \in K \tag{V4} \label{eq:RouteCompletion} \\
& \sum_{\substack{i \in V_k \\ i \neq \sigma_k}} x_{i\sigma_k}^k = \sum_{\substack{j \in V_k \\ j \neq \tau_k}} x_{\tau_k j}^k = 0, &\quad \forall k \in K \tag{V5} \label{eq:InvalidArcPrevention} \\
& x_{ij}^k \le p_j^k, &\quad \forall i \in V^k, j \in V, i \neq j, \forall k \in K \tag{V6} \label{eq:Qualification} \\
& t_i^k \ge e_i, &\quad \forall i \in V, \forall k \in K \tag{V7} \label{eq:EarliestArrival} \\
& t_i^k \le l_i - s_i, &\quad \forall i \in V, \forall k \in K \tag{V8} \label{eq:LatestArrival} \\
& t_j^k \ge t_i^k + c_{ij} + s_i - M(1 - x_{ij}^k), &\quad \forall i, j \in V_k, i \neq j, \forall k \in K \tag{V9} \label{eq:TemporalFeasibility} \\
& d^k \ge t_{\tau_k}^k - t_{\sigma_k}^k - \sum_{i \in V} s_i (\sum_{\substack{j \in V_k \\ j \neq i}} x_{ji}^k), &\quad \forall k \in K \tag{V10} \label{eq:DowntimeDefinition}
\end{align}

\textit{Possible extensions: lunch breaks, maximum shift length, and earliest/latest work times.}
\\\\
\textbf{Constraint explanations:}
\begin{itemize}
\item \textbf{Unique Visit Constraint \eqref{eq:UniqueVisit}}:  ensures each patient is visited exactly once by one caregiver.
\item \textbf{Flow Conservation Constraint \eqref{eq:FlowConservation}}:  ensures flow conservation for patients, ensuring continuous caregiver routes.
\item \textbf{Route Completion Constraint \eqref{eq:RouteCompletion}}:  ensures caregivers either complete a full route or are not used.
\item \textbf{Invalid Arc Prevention Constraint \eqref{eq:InvalidArcPrevention}}:  prevents invalid arcs from entering start nodes or leaving end nodes.
\item \textbf{Qualification Constraint \eqref{eq:Qualification}}:  ensures caregivers only visit patients they are qualified for.
\item \textbf{Earliest Arrival Constraint \eqref{eq:EarliestArrival}}:  ensures caregivers don't arrive at patients before their earliest service time.
\item \textbf{Latest Arrival Constraint \eqref{eq:LatestArrival}}:  ensures caregivers arrive early enough to complete services within time windows.
\item \textbf{Temporal Feasibility Constraint \eqref{eq:TemporalFeasibility}}:  ensures temporal feasibility of visits, respecting travel and service times.
\item \textbf{Downtime Definition Constraint \eqref{eq:DowntimeDefinition}}:  defines caregiver downtime as the total idle time between start and end nodes, excluding service durations.
\end{itemize}

\end{document}
